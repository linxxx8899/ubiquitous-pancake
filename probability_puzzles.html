<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å„¿ç«¥æ¦‚ç‡è§£è°œæ¸¸æˆ | Probability Puzzles for Kids</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .game-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .game-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .game-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0,0,0,0.2);
        }

        .game-card.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .game-card h2 {
            font-size: 1.5em;
            margin-bottom: 10px;
        }

        .game-card p {
            font-size: 0.9em;
            line-height: 1.5;
            opacity: 0.8;
        }

        .game-area {
            background: white;
            border-radius: 15px;
            padding: 30px;
            min-height: 400px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
            display: none;
        }

        .game-area.active {
            display: block;
        }

        .game-title {
            font-size: 2em;
            margin-bottom: 20px;
            color: #667eea;
        }

        .game-description {
            font-size: 1.1em;
            margin-bottom: 30px;
            line-height: 1.6;
            color: #666;
        }

        .button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.2);
        }

        .button:active {
            transform: translateY(0);
        }

        .button.secondary {
            background: #6c757d;
        }

        .doors-container, .paths-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .door, .path-option {
            width: 120px;
            height: 180px;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            color: white;
            font-size: 2em;
            font-weight: bold;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .door:hover, .path-option:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 12px rgba(0,0,0,0.2);
        }

        .door.opened {
            background: #6c757d;
            cursor: not-allowed;
        }

        .path-option {
            height: auto;
            padding: 20px;
            font-size: 1em;
            text-align: center;
        }

        .path-option .path-name {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .path-option .path-stats {
            font-size: 0.85em;
            line-height: 1.5;
        }

        .guess-input {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .guess-input input {
            padding: 15px;
            font-size: 1.2em;
            border: 2px solid #667eea;
            border-radius: 10px;
            width: 150px;
            text-align: center;
        }

        .message {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
            font-size: 1.1em;
        }

        .message.success {
            border-left-color: #28a745;
            background: #d4edda;
        }

        .message.error {
            border-left-color: #dc3545;
            background: #f8d7da;
        }

        .statistics {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .statistics h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #dee2e6;
        }

        .stat-item:last-child {
            border-bottom: none;
        }

        .slot-machine {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 30px 0;
        }

        .reel {
            width: 100px;
            height: 100px;
            background: white;
            border: 3px solid #667eea;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3em;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .probability-chart {
            margin: 20px 0;
        }

        .chart-bar {
            display: flex;
            align-items: center;
            margin: 10px 0;
        }

        .chart-label {
            width: 100px;
            font-size: 1.5em;
        }

        .chart-fill {
            height: 30px;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            border-radius: 5px;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding: 0 10px;
            color: white;
            font-size: 0.9em;
        }

        .progress-bar {
            background: #e9ecef;
            border-radius: 10px;
            height: 30px;
            margin: 20px 0;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            height: 100%;
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }

            .door, .path-option {
                width: 100px;
                height: 150px;
            }

            .game-card {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ² å„¿ç«¥æ¦‚ç‡è§£è°œæ¸¸æˆ</h1>
            <p>Probability Puzzles for Kids</p>
        </div>

        <div class="game-selector">
            <div class="game-card" onclick="selectGame('monty-hall')">
                <h2>ğŸšª ä¸‰é—¨é—®é¢˜</h2>
                <p>ç»å…¸æ¦‚ç‡æ‚–è®ºï¼Œå­¦ä¹ æ¡ä»¶æ¦‚ç‡çš„é­…åŠ›</p>
                <p style="margin-top: 10px; opacity: 0.7;">Monty Hall Problem - Learn conditional probability</p>
            </div>
            <div class="game-card" onclick="selectGame('number-guess')">
                <h2>ğŸ”¢ çŒœæ•°å­—</h2>
                <p>é€šè¿‡åé¦ˆç¼©å°èŒƒå›´ï¼Œç†è§£ä¿¡æ¯ç†µ</p>
                <p style="margin-top: 10px; opacity: 0.7;">Number Guessing - Understand information entropy</p>
            </div>
            <div class="game-card" onclick="selectGame('probability-race')">
                <h2>ğŸ æ¦‚ç‡èµ›é“</h2>
                <p>è®¡ç®—æœŸæœ›å€¼ï¼Œåšå‡ºæœ€ä¼˜å†³ç­–</p>
                <p style="margin-top: 10px; opacity: 0.7;">Probability Race - Calculate expected values</p>
            </div>
            <div class="game-card" onclick="selectGame('slot-machine')">
                <h2>ğŸ° æ¦‚ç‡æ¨¡æ‹Ÿå™¨</h2>
                <p>è§‚å¯Ÿå¤§æ•°å®šå¾‹ï¼Œç†è§£éšæœºæ€§</p>
                <p style="margin-top: 10px; opacity: 0.7;">Slot Machine - Observe law of large numbers</p>
            </div>
        </div>

        <!-- ä¸‰é—¨é—®é¢˜æ¸¸æˆ -->
        <div id="monty-hall" class="game-area">
            <h2 class="game-title">ğŸšª ä¸‰é—¨é—®é¢˜ Monty Hall Problem</h2>
            <p class="game-description">
                ä¸‰æ‰‡é—¨ä¸­æœ‰ä¸€æ‰‡é—¨åæœ‰æ±½è½¦ğŸš—ï¼Œå¦å¤–ä¸¤æ‰‡é—¨åæ˜¯å±±ç¾ŠğŸã€‚ä½ å…ˆé€‰æ‹©ä¸€æ‰‡é—¨ï¼Œç„¶åä¸»æŒäººä¼šæ‰“å¼€ä¸€æ‰‡æœ‰å±±ç¾Šçš„é—¨ï¼Œå¹¶ç»™ä½ ä¸€æ¬¡æ›´æ¢é€‰æ‹©çš„æœºä¼šã€‚æ¢è¿˜æ˜¯ä¸æ¢ï¼Ÿ
                <br><br>
                Behind one of three doors is a car ğŸš—, behind the other two are goats ğŸ. You choose a door, then the host opens a door with a goat, and gives you a chance to switch. Should you switch?
            </p>
            <div id="monty-game-state"></div>
            <div class="controls">
                <button class="button" onclick="startMontyHall()">å¼€å§‹æ¸¸æˆ Start Game</button>
                <button class="button secondary" onclick="simulateMontyHall()">æ¨¡æ‹Ÿ1000æ¬¡ Simulate 1000x</button>
            </div>
            <div id="monty-simulation-results"></div>
        </div>

        <!-- çŒœæ•°å­—æ¸¸æˆ -->
        <div id="number-guess" class="game-area">
            <h2 class="game-title">ğŸ”¢ çŒœæ•°å­—æ¸¸æˆ Number Guessing Game</h2>
            <p class="game-description">
                æˆ‘æƒ³äº†ä¸€ä¸ª1åˆ°100ä¹‹é—´çš„æ•°å­—ï¼Œè¯·é€šè¿‡"å¤ªå¤§"æˆ–"å¤ªå°"çš„æç¤ºæ¥çŒœå‡ºè¿™ä¸ªæ•°å­—ã€‚ä½ èƒ½ç”¨æœ€å°‘çš„æ¬¡æ•°çŒœä¸­å—ï¼Ÿ
                <br><br>
                I'm thinking of a number between 1 and 100. Use "too high" or "too low" hints to guess it. Can you guess with minimum attempts?
            </p>
            <div class="controls">
                <label>éš¾åº¦ Difficulty: </label>
                <select id="difficulty-select" style="padding: 10px; border-radius: 5px; border: 2px solid #667eea;">
                    <option value="easy">ç®€å• Easy</option>
                    <option value="medium" selected>ä¸­ç­‰ Medium</option>
                    <option value="hard">å›°éš¾ Hard</option>
                </select>
                <button class="button" onclick="startNumberGuess()">å¼€å§‹æ¸¸æˆ Start Game</button>
            </div>
            <div id="number-game-state"></div>
        </div>

        <!-- æ¦‚ç‡èµ›é“æ¸¸æˆ -->
        <div id="probability-race" class="game-area">
            <h2 class="game-title">ğŸ æ¦‚ç‡èµ›é“ Probability Race</h2>
            <p class="game-description">
                ä»èµ·ç‚¹åˆ°è¾¾ç»ˆç‚¹ï¼Œæ¯ä¸ªè·¯å£éƒ½è¦é€‰æ‹©ä¸€æ¡è·¯å¾„ã€‚ä¸åŒçš„è·¯å¾„æœ‰ä¸åŒçš„å‰è¿›è·ç¦»å’ŒæˆåŠŸæ¦‚ç‡ã€‚è®¡ç®—æœŸæœ›å€¼ï¼Œé€‰æ‹©æœ€ä¼˜ç­–ç•¥ï¼
                <br><br>
                Reach the finish line by choosing paths at each junction. Different paths have different distances and success rates. Calculate expected values and choose wisely!
            </p>
            <div class="controls">
                <button class="button" onclick="startProbabilityRace()">å¼€å§‹æ¸¸æˆ Start Game</button>
            </div>
            <div id="race-game-state"></div>
        </div>

        <!-- è€è™æœºæ¨¡æ‹Ÿå™¨ -->
        <div id="slot-machine" class="game-area">
            <h2 class="game-title">ğŸ° æ¦‚ç‡æ¨¡æ‹Ÿå™¨ Probability Simulator</h2>
            <p class="game-description">
                è¿™æ˜¯ä¸€ä¸ªå±•ç¤ºæ¦‚ç‡å’Œå¤§æ•°å®šå¾‹çš„æ¨¡æ‹Ÿå™¨ã€‚æ¯ä¸ªç¬¦å·æœ‰ä¸åŒçš„å‡ºç°æ¦‚ç‡ã€‚è½¬åŠ¨è¶Šå¤šæ¬¡ï¼Œå®é™…é¢‘ç‡è¶Šæ¥è¿‘ç†è®ºæ¦‚ç‡ï¼
                <br><br>
                This simulator demonstrates probability and the law of large numbers. Each symbol has different probabilities. The more you spin, the closer the actual frequency gets to theoretical probability!
            </p>
            <div class="statistics">
                <h3>ç¬¦å·æ¦‚ç‡ Symbol Probabilities</h3>
                <div class="probability-chart" id="symbol-probabilities"></div>
            </div>
            <div class="slot-machine" id="slot-reels">
                <div class="reel">?</div>
                <div class="reel">?</div>
                <div class="reel">?</div>
            </div>
            <div class="controls">
                <button class="button" onclick="spinSlot()">è½¬åŠ¨ Spin</button>
                <button class="button secondary" onclick="spinMultiple(10)">è½¬åŠ¨10æ¬¡ Spin 10x</button>
                <button class="button secondary" onclick="spinMultiple(100)">è½¬åŠ¨100æ¬¡ Spin 100x</button>
                <button class="button secondary" onclick="resetSlot()">é‡ç½® Reset</button>
            </div>
            <div id="slot-message"></div>
            <div id="slot-statistics"></div>
        </div>
    </div>

    <script>
        // æ¸¸æˆçŠ¶æ€
        let currentGame = null;
        let montyHallState = { car: 0, choice: 0, opened: 0, stage: 'initial' };
        let numberGuessState = { target: 0, guesses: [], maxAttempts: 0, gameOver: false };
        let raceState = { position: 0, target: 10, history: [] };
        let slotState = { 
            symbols: ['ğŸ', 'ğŸŒ', 'â­', 'ğŸ’', 'ğŸ””'],
            probabilities: [0.35, 0.25, 0.20, 0.15, 0.05],
            history: [],
            symbolCounts: {}
        };

        // åˆå§‹åŒ–è€è™æœºç¬¦å·è®¡æ•°
        slotState.symbols.forEach(s => slotState.symbolCounts[s] = 0);

        // æ˜¾ç¤ºç¬¦å·æ¦‚ç‡
        function displaySymbolProbabilities() {
            const container = document.getElementById('symbol-probabilities');
            container.innerHTML = slotState.symbols.map((symbol, i) => {
                const prob = slotState.probabilities[i];
                return `
                    <div class="chart-bar">
                        <div class="chart-label">${symbol}</div>
                        <div class="chart-fill" style="width: ${prob * 100}%; min-width: 60px;">
                            ${(prob * 100).toFixed(0)}%
                        </div>
                    </div>
                `;
            }).join('');
        }

        // é€‰æ‹©æ¸¸æˆ
        function selectGame(gameId) {
            // æ›´æ–°å¡ç‰‡çŠ¶æ€
            document.querySelectorAll('.game-card').forEach(card => card.classList.remove('active'));
            event.target.closest('.game-card').classList.add('active');

            // æ˜¾ç¤ºå¯¹åº”æ¸¸æˆåŒºåŸŸ
            document.querySelectorAll('.game-area').forEach(area => area.classList.remove('active'));
            document.getElementById(gameId).classList.add('active');

            currentGame = gameId;

            // ç‰¹æ®Šåˆå§‹åŒ–
            if (gameId === 'slot-machine') {
                displaySymbolProbabilities();
            }
        }

        // === ä¸‰é—¨é—®é¢˜ ===
        function startMontyHall() {
            montyHallState = {
                car: Math.floor(Math.random() * 3) + 1,
                choice: 0,
                opened: 0,
                stage: 'choosing'
            };

            const html = `
                <div class="message">è¯·é€‰æ‹©ä¸€æ‰‡é—¨ Please choose a door</div>
                <div class="doors-container">
                    <div class="door" onclick="chooseDoor(1)">ğŸšª<br>1</div>
                    <div class="door" onclick="chooseDoor(2)">ğŸšª<br>2</div>
                    <div class="door" onclick="chooseDoor(3)">ğŸšª<br>3</div>
                </div>
            `;
            document.getElementById('monty-game-state').innerHTML = html;
        }

        function chooseDoor(doorNum) {
            if (montyHallState.stage !== 'choosing') return;

            montyHallState.choice = doorNum;
            montyHallState.stage = 'switching';

            // ä¸»æŒäººæ‰“å¼€ä¸€æ‰‡æœ‰å±±ç¾Šçš„é—¨
            const availableDoors = [1, 2, 3].filter(d => d !== montyHallState.car && d !== doorNum);
            montyHallState.opened = availableDoors[Math.floor(Math.random() * availableDoors.length)];

            const remainingDoor = [1, 2, 3].find(d => d !== doorNum && d !== montyHallState.opened);

            const html = `
                <div class="message">
                    ä½ é€‰æ‹©äº†é—¨${doorNum}ã€‚ä¸»æŒäººæ‰“å¼€äº†é—¨${montyHallState.opened}ï¼Œé‡Œé¢æ˜¯å±±ç¾ŠğŸï¼
                    <br>
                    You chose door ${doorNum}. The host opened door ${montyHallState.opened}, revealing a goat ğŸ!
                    <br><br>
                    ä½ è¦æ¢åˆ°é—¨${remainingDoor}å—ï¼Ÿ
                    <br>
                    Do you want to switch to door ${remainingDoor}?
                </div>
                <div class="doors-container">
                    ${[1, 2, 3].map(d => {
                        if (d === montyHallState.opened) {
                            return `<div class="door opened">ğŸ<br>${d}<br>(å·²æ‰“å¼€)</div>`;
                        } else if (d === doorNum) {
                            return `<div class="door" style="border: 3px solid gold;">ğŸšª<br>${d}<br>(ä½ çš„é€‰æ‹©)</div>`;
                        } else {
                            return `<div class="door">ğŸšª<br>${d}</div>`;
                        }
                    }).join('')}
                </div>
                <div class="controls">
                    <button class="button" onclick="finalDecision(false)">ä¸æ¢ Stay</button>
                    <button class="button" onclick="finalDecision(true)">æ¢é—¨ Switch</button>
                </div>
            `;
            document.getElementById('monty-game-state').innerHTML = html;
        }

        function finalDecision(shouldSwitch) {
            if (montyHallState.stage !== 'switching') return;

            const finalChoice = shouldSwitch 
                ? [1, 2, 3].find(d => d !== montyHallState.choice && d !== montyHallState.opened)
                : montyHallState.choice;

            const won = finalChoice === montyHallState.car;

            const html = `
                <div class="message ${won ? 'success' : 'error'}">
                    ${shouldSwitch ? 'ä½ é€‰æ‹©äº†æ¢é—¨' : 'ä½ é€‰æ‹©äº†ä¸æ¢'} | ${shouldSwitch ? 'You switched' : 'You stayed'}
                    <br><br>
                    æ±½è½¦åœ¨é—¨${montyHallState.car}ï¼${won ? 'ğŸ‰ ä½ èµ¢äº†ï¼' : 'ğŸ˜¢ ä½ è¾“äº†ï¼'}
                    <br>
                    The car was behind door ${montyHallState.car}! ${won ? 'ğŸ‰ You won!' : 'ğŸ˜¢ You lost!'}
                </div>
                <div class="doors-container">
                    ${[1, 2, 3].map(d => {
                        const content = d === montyHallState.car ? 'ğŸš—' : 'ğŸ';
                        const label = d === finalChoice ? '(ä½ çš„æœ€ç»ˆé€‰æ‹©)' : d === montyHallState.opened ? '(å·²æ‰“å¼€)' : '';
                        return `<div class="door opened">${content}<br>${d}<br>${label}</div>`;
                    }).join('')}
                </div>
                <div class="controls">
                    <button class="button" onclick="startMontyHall()">å†ç©ä¸€æ¬¡ Play Again</button>
                </div>
            `;
            document.getElementById('monty-game-state').innerHTML = html;
            montyHallState.stage = 'finished';
        }

        function simulateMontyHall() {
            let switchWins = 0;
            let stayWins = 0;
            const trials = 1000;

            for (let i = 0; i < trials; i++) {
                const car = Math.floor(Math.random() * 3) + 1;
                const choice = 1; // æ€»æ˜¯é€‰æ‹©é—¨1

                // æ¢é—¨ç­–ç•¥
                const availableDoors = [1, 2, 3].filter(d => d !== car && d !== choice);
                const opened = availableDoors[Math.floor(Math.random() * availableDoors.length)];
                const switchChoice = [1, 2, 3].find(d => d !== choice && d !== opened);
                if (switchChoice === car) switchWins++;

                // ä¸æ¢é—¨ç­–ç•¥
                if (choice === car) stayWins++;
            }

            const html = `
                <div class="statistics">
                    <h3>æ¨¡æ‹Ÿ${trials}æ¬¡æ¸¸æˆçš„ç»“æœ Simulation Results (${trials} games)</h3>
                    <div class="stat-item">
                        <span>æ¢é—¨ç­–ç•¥èƒœç‡ Switch strategy:</span>
                        <strong>${(switchWins / trials * 100).toFixed(1)}%</strong>
                    </div>
                    <div class="stat-item">
                        <span>ä¸æ¢ç­–ç•¥èƒœç‡ Stay strategy:</span>
                        <strong>${(stayWins / trials * 100).toFixed(1)}%</strong>
                    </div>
                    <div style="margin-top: 15px; padding-top: 15px; border-top: 2px solid #667eea; color: #667eea; font-weight: bold;">
                        ç»“è®ºï¼šæ¢é—¨ç­–ç•¥çš„èƒœç‡çº¦ä¸º2/3ï¼<br>
                        Conclusion: Switching has approximately 2/3 win rate!
                    </div>
                </div>
            `;
            document.getElementById('monty-simulation-results').innerHTML = html;
        }

        // === çŒœæ•°å­—æ¸¸æˆ ===
        function startNumberGuess() {
            const difficulty = document.getElementById('difficulty-select').value;
            const min = 1, max = 100;
            const range = max - min;
            
            const maxAttempts = {
                'easy': Math.ceil(Math.log2(range)) + 5,
                'medium': Math.ceil(Math.log2(range)) + 2,
                'hard': Math.ceil(Math.log2(range))
            }[difficulty];

            numberGuessState = {
                target: Math.floor(Math.random() * range) + min,
                guesses: [],
                maxAttempts: maxAttempts,
                gameOver: false,
                min: min,
                max: max
            };

            const html = `
                <div class="message">
                    æˆ‘æƒ³äº†ä¸€ä¸ª${min}åˆ°${max}ä¹‹é—´çš„æ•°å­—ï¼Œä½ æœ‰${maxAttempts}æ¬¡æœºä¼šï¼
                    <br>
                    I'm thinking of a number between ${min} and ${max}. You have ${maxAttempts} attempts!
                </div>
                <div class="guess-input">
                    <input type="number" id="guess-input" min="${min}" max="${max}" placeholder="è¾“å…¥æ•°å­—">
                    <button class="button" onclick="makeGuess()">çŒœæµ‹ Guess</button>
                </div>
                <div id="guess-history"></div>
            `;
            document.getElementById('number-game-state').innerHTML = html;

            // æ·»åŠ å›è½¦é”®æ”¯æŒ
            document.getElementById('guess-input').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') makeGuess();
            });
        }

        function makeGuess() {
            if (numberGuessState.gameOver) return;

            const input = document.getElementById('guess-input');
            const guess = parseInt(input.value);

            if (isNaN(guess) || guess < numberGuessState.min || guess > numberGuessState.max) {
                alert(`è¯·è¾“å…¥${numberGuessState.min}åˆ°${numberGuessState.max}ä¹‹é—´çš„æ•°å­— Please enter a number between ${numberGuessState.min} and ${numberGuessState.max}`);
                return;
            }

            numberGuessState.guesses.push(guess);
            const attemptsLeft = numberGuessState.maxAttempts - numberGuessState.guesses.length;

            input.value = '';

            if (guess === numberGuessState.target) {
                numberGuessState.gameOver = true;
                const html = `
                    <div class="message success">
                        ğŸ‰ æ­å–œï¼ä½ ç”¨${numberGuessState.guesses.length}æ¬¡å°±çŒœå¯¹äº†ï¼
                        <br>
                        ğŸ‰ Congratulations! You guessed it in ${numberGuessState.guesses.length} attempts!
                    </div>
                    ${displayGuessHistory()}
                    <div class="controls">
                        <button class="button" onclick="startNumberGuess()">å†ç©ä¸€æ¬¡ Play Again</button>
                    </div>
                `;
                document.getElementById('number-game-state').innerHTML = html;
            } else if (attemptsLeft === 0) {
                numberGuessState.gameOver = true;
                const html = `
                    <div class="message error">
                        ğŸ˜¢ å¾ˆé—æ†¾ï¼Œæ¬¡æ•°ç”¨å®Œäº†ï¼ç­”æ¡ˆæ˜¯${numberGuessState.target}ã€‚
                        <br>
                        ğŸ˜¢ Sorry, you're out of attempts! The answer was ${numberGuessState.target}.
                    </div>
                    ${displayGuessHistory()}
                    <div class="controls">
                        <button class="button" onclick="startNumberGuess()">å†ç©ä¸€æ¬¡ Play Again</button>
                    </div>
                `;
                document.getElementById('number-game-state').innerHTML = html;
            } else {
                const hint = guess > numberGuessState.target ? 'å¤ªå¤§äº† Too high' : 'å¤ªå°äº† Too low';
                document.getElementById('guess-history').innerHTML = `
                    <div class="message">
                        ${hint}ï¼è¿˜æœ‰${attemptsLeft}æ¬¡æœºä¼š ${attemptsLeft} attempts left
                    </div>
                    ${displayGuessHistory()}
                `;
            }
        }

        function displayGuessHistory() {
            return `
                <div class="statistics">
                    <h3>çŒœæµ‹å†å² Guess History</h3>
                    ${numberGuessState.guesses.map((g, i) => {
                        const result = g === numberGuessState.target ? 'âœ“ æ­£ç¡®!' : 
                                     g > numberGuessState.target ? 'â†“ å¤ªå¤§' : 'â†‘ å¤ªå°';
                        return `<div class="stat-item"><span>ç¬¬${i+1}æ¬¡: ${g}</span><span>${result}</span></div>`;
                    }).join('')}
                </div>
            `;
        }

        // === æ¦‚ç‡èµ›é“æ¸¸æˆ ===
        function startProbabilityRace() {
            raceState = {
                position: 0,
                target: 10,
                history: []
            };
            showRacePaths();
        }

        function showRacePaths() {
            if (raceState.position >= raceState.target) {
                const html = `
                    <div class="message success">
                        ğŸ† æ­å–œåˆ°è¾¾ç»ˆç‚¹ï¼æ€»å…±èµ°äº†${raceState.history.length}æ­¥ã€‚
                        <br>
                        ğŸ† Congratulations! You reached the finish in ${raceState.history.length} steps!
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 100%;">å®Œæˆ!</div>
                    </div>
                    ${displayRaceHistory()}
                    <div class="controls">
                        <button class="button" onclick="startProbabilityRace()">å†ç©ä¸€æ¬¡ Play Again</button>
                    </div>
                `;
                document.getElementById('race-game-state').innerHTML = html;
                return;
            }

            // ç”Ÿæˆè·¯å¾„é€‰é¡¹
            const paths = generatePaths();

            const html = `
                <div class="message">
                    å½“å‰ä½ç½® Current position: ${raceState.position} / ${raceState.target}
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: ${raceState.position / raceState.target * 100}%">
                        ${raceState.position}/${raceState.target}
                    </div>
                </div>
                <div class="paths-container">
                    ${paths.map(path => `
                        <div class="path-option" onclick='choosePath(${JSON.stringify(path)})'>
                            <div class="path-name">${path.name}</div>
                            <div class="path-stats">
                                å‰è¿›: ${path.distance}æ­¥<br>
                                æˆåŠŸç‡: ${(path.successRate * 100).toFixed(0)}%<br>
                                æœŸæœ›å€¼: ${path.expectedValue.toFixed(2)}
                            </div>
                        </div>
                    `).join('')}
                </div>
                ${raceState.history.length > 0 ? displayRaceHistory() : ''}
            `;
            document.getElementById('race-game-state').innerHTML = html;
        }

        function generatePaths() {
            return [
                {
                    id: 'safe',
                    name: 'ğŸ›¡ï¸ å®‰å…¨è·¯å¾„',
                    distance: Math.floor(Math.random() * 2) + 1,
                    successRate: 1.0,
                    penalty: 0,
                    get expectedValue() { return this.distance * this.successRate; }
                },
                {
                    id: 'risky',
                    name: 'âš¡ å†’é™©è·¯å¾„',
                    distance: Math.floor(Math.random() * 3) + 3,
                    successRate: Math.random() * 0.2 + 0.5,
                    penalty: -1,
                    get expectedValue() { return this.distance * this.successRate; }
                },
                {
                    id: 'balanced',
                    name: 'âš–ï¸ å¹³è¡¡è·¯å¾„',
                    distance: Math.floor(Math.random() * 2) + 2,
                    successRate: Math.random() * 0.15 + 0.75,
                    penalty: 0,
                    get expectedValue() { return this.distance * this.successRate; }
                }
            ];
        }

        function choosePath(path) {
            const success = Math.random() < path.successRate;
            const oldPosition = raceState.position;

            if (success) {
                raceState.position += path.distance;
            } else if (path.penalty < 0) {
                raceState.position = Math.max(0, raceState.position + path.penalty);
            }

            raceState.history.push({
                path: path.name,
                success: success,
                oldPosition: oldPosition,
                newPosition: raceState.position
            });

            showRacePaths();
        }

        function displayRaceHistory() {
            return `
                <div class="statistics">
                    <h3>è¡ŒåŠ¨å†å² Action History</h3>
                    ${raceState.history.map((h, i) => `
                        <div class="stat-item">
                            <span>ç¬¬${i+1}æ­¥: ${h.path}</span>
                            <span>${h.success ? 'âœ“' : 'âœ—'} ${h.oldPosition}â†’${h.newPosition}</span>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // === è€è™æœºæ¨¡æ‹Ÿå™¨ ===
        function spinSlot() {
            const result = [];
            const reels = document.querySelectorAll('.reel');

            // åŠ¨ç”»æ•ˆæœ
            reels.forEach(reel => {
                reel.style.transform = 'rotateX(360deg)';
                reel.style.transition = 'transform 0.5s';
            });

            setTimeout(() => {
                for (let i = 0; i < 3; i++) {
                    const symbol = weightedRandom(slotState.symbols, slotState.probabilities);
                    result.push(symbol);
                    slotState.symbolCounts[symbol]++;
                    reels[i].textContent = symbol;
                    reels[i].style.transform = 'rotateX(0deg)';
                }

                slotState.history.push(result);

                // åˆ¤æ–­ä¸­å¥–
                const uniqueSymbols = new Set(result);
                let message = '';
                let messageClass = '';

                if (uniqueSymbols.size === 1) {
                    message = `ğŸ‰ å¤§å¥–ï¼ä¸‰ä¸ª${result[0]}ï¼Jackpot!`;
                    messageClass = 'success';
                } else if (uniqueSymbols.size === 2) {
                    message = 'ğŸŠ å°å¥–ï¼ä¸¤ä¸ªç›¸åŒï¼Small win!';
                    messageClass = 'success';
                } else {
                    message = 'å†è¯•ä¸€æ¬¡ï¼Try again!';
                    messageClass = '';
                }

                document.getElementById('slot-message').innerHTML = `
                    <div class="message ${messageClass}">${message}</div>
                `;

                updateSlotStatistics();
            }, 500);
        }

        function spinMultiple(times) {
            let count = 0;
            const interval = setInterval(() => {
                if (count >= times) {
                    clearInterval(interval);
                    return;
                }
                spinSlot();
                count++;
            }, 600);
        }

        function resetSlot() {
            slotState.history = [];
            slotState.symbols.forEach(s => slotState.symbolCounts[s] = 0);
            document.getElementById('slot-message').innerHTML = '';
            document.getElementById('slot-statistics').innerHTML = '';
            document.querySelectorAll('.reel').forEach(reel => reel.textContent = '?');
        }

        function updateSlotStatistics() {
            const totalSpins = slotState.history.length;
            const totalSymbols = totalSpins * 3;

            const frequencies = {};
            slotState.symbols.forEach((symbol, i) => {
                const count = slotState.symbolCounts[symbol];
                const actualFreq = totalSymbols > 0 ? count / totalSymbols : 0;
                const expectedFreq = slotState.probabilities[i];
                frequencies[symbol] = { actual: actualFreq, expected: expectedFreq, count: count };
            });

            const html = `
                <div class="statistics">
                    <h3>ç»Ÿè®¡æ•°æ® Statistics (æ€»è½¬åŠ¨æ¬¡æ•° Total spins: ${totalSpins})</h3>
                    <div style="margin: 15px 0;">
                        ${slotState.symbols.map(symbol => {
                            const freq = frequencies[symbol];
                            return `
                                <div class="stat-item">
                                    <span>${symbol} (æ¬¡æ•°: ${freq.count})</span>
                                    <span>
                                        å®é™…: ${(freq.actual * 100).toFixed(1)}% | 
                                        æœŸæœ›: ${(freq.expected * 100).toFixed(0)}%
                                    </span>
                                </div>
                            `;
                        }).join('')}
                    </div>
                    ${totalSpins >= 100 ? `
                        <div style="margin-top: 15px; padding-top: 15px; border-top: 2px solid #667eea; color: #667eea;">
                            ğŸ’¡ è§‚å¯Ÿï¼šè½¬åŠ¨æ¬¡æ•°è¶Šå¤šï¼Œå®é™…é¢‘ç‡è¶Šæ¥è¿‘æœŸæœ›æ¦‚ç‡ï¼<br>
                            ğŸ’¡ Observation: The more spins, the closer actual frequency gets to expected probability!
                        </div>
                    ` : ''}
                </div>
            `;
            document.getElementById('slot-statistics').innerHTML = html;
        }

        function weightedRandom(items, weights) {
            const totalWeight = weights.reduce((a, b) => a + b, 0);
            let random = Math.random() * totalWeight;

            for (let i = 0; i < items.length; i++) {
                random -= weights[i];
                if (random <= 0) {
                    return items[i];
                }
            }
            return items[items.length - 1];
        }

        // é»˜è®¤é€‰æ‹©ç¬¬ä¸€ä¸ªæ¸¸æˆ
        window.addEventListener('DOMContentLoaded', () => {
            selectGame('monty-hall');
        });
    </script>
</body>
</html>
